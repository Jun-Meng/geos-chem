# This file details how to generate the offline dust emissions 
# To be read by the GEOS-Chem model in v11-02 (or higher)
# -------------------------------------------------------------
# The emissions are based on the reduced meteorological fields
# archived at Dalhousie from MERRA-2 and GEOS-FP at native resolution
# (0.5x0.625 and 0.25x0.3125, respectively).
# By using offline dust, the GEOS-Chem model benefits from the higher
# spatial resolution of winds and soil moisture that control dust 
# emissions.
# The dust emission scheme is identical to the standard implementation
# of the DEAD dust scheme in GEOS-Chem that relies on 2 x 2.5 deg
# source and soil texture maps, so is still limited in the same way in
# that regard. Future developments in the dust scheme provide an 
# improved dust emission simulation can easily be converted into updated
# offline emissions files using this code 
# (a year of MERRA-2 dust emissions are generated in only a few hours)
#

HEMCO_sa_Config.rc sets the input/output folders and lists the variables
required for dust emission. Ensure that these directories match your system.
".YYYMMDDHHMM.nc" will be appended to the end of the output DiagnPrefix
The standalone code reads in met fields directly and maps them onto the 
variables required by the dust emissions code /HEMCO/Extensions/hcox_dustdead_mod.F
Those met fields are the reduced variable files "RED" that are processed
and available from Dalhousie. You'll see them listed in the HEMCO_sa_Config like:
/data/ctm/MERRA2_0.5x0.625/$YYYY/$MM/MERRA2.$YYYY$MM$DD.A1.05x0625.RED.nc4
/data/ctm/MERRA2_0.5x0.625/$YYYY/$MM/MERRA2.$YYYY$MM$DD.I3.05x0625.RED.nc4
Make sure the directory is correct and that both A1 and I3 files are available.

HEMCO_sa_Time.rc indicates the range of times for the emission calculatio and 
the timestep. Emissions are calculated hourly as this is the output frequency,
and the frequency at which the offline dust emissions are read into the GEOS-Chem model.

HEMCO_sa_Grid.rc specifies the HEMCO grid on which the emissions are calculated.
This is set to the 0.5x0.625 MERRA-2 grid, but can be altered to the GEOS-FP
grid size if reading in the reduced GEOS-FP met fields.

The species to be traced and the diagnostics to be output are included in
HEMCO_sa_Spec.rc and HEMCO_sa_Diagn.rc

You will need to generate hemco_standalone.x by compiling GEOS-Chem with the following:
make -j4 COMPILER=ifort MET=merra2 GRID=05x0625 CHEM=tropchem
(or equivalent settings for GEOS-FP)
The GEOS-Chem model will unlikely compile at this resolution as a global model,
however, it should get far enough to output the hemco_standalone.x into /bin/  
(if you are using an older version of the model there are minor changes to be made in
CMN_SIZE_mod and Makefile_header that will allow compilation to proceed far enough
with GRID=05x0625)

Once everything is set up, run hemco_standalone.x and the dust emissions will
be output in the selected directory.

N.B.  Dust emissions will be saved with no scaling factor. This is applied to the 
tracers when they are read in via HEMCO_Config.rc

===============================

The GEOS-Chem model can now be run using offline dust emissions:

Switching off DustDead (105) and DustGinoux (106) extensions in HEMCO_Config.rc
will activate the offline dust (see the HEMCO_Config_0625.rc file in this folder). 
The location of the emissions to read in are required
and should be added in the SECTION BASE EMISSIONS:

#==============================================================================
# --- OFFLINE DUST ---
#==============================================================================
# 0.5 x 0.625
0 EMIS_DST1 /net/seurat/data/ctm/offline_dust_0625/$YYYY/dust_emissions_0625.$YYYY$MM$DD$HH00.nc EMIS_DST1 1980-2017/1-12/1-31/0-23 C xy kg/m2/s DST1 606 1 2
0 EMIS_DST2 /net/seurat/data/ctm/offline_dust_0625/$YYYY/dust_emissions_0625.$YYYY$MM$DD$HH00.nc EMIS_DST2 1980-2017/1-12/1-31/0-23 C xy kg/m2/s DST2 606 1 2
0 EMIS_DST3 /net/seurat/data/ctm/offline_dust_0625/$YYYY/dust_emissions_0625.$YYYY$MM$DD$HH00.nc EMIS_DST3 1980-2017/1-12/1-31/0-23 C xy kg/m2/s DST3 606 1 2
0 EMIS_DST4 /net/seurat/data/ctm/offline_dust_0625/$YYYY/dust_emissions_0625.$YYYY$MM$DD$HH00.nc EMIS_DST4 1980-2017/1-12/1-31/0-23 C xy kg/m2/s DST4 606 1 2

This will point to the offline hourly dust emissions and extract the EMIS_DSTX 
variables and to be put into the DSTX tracers in place of the online calculation.

Because the offline emissions are saved without a scale factor, a scaling factor 
for dust must be included near the end of the HEMCO_Config.rc file in the 
SECTION SCALE FACTORS:

606 DUST_EMISSIONS    0.0005                                        - -               - xy 1 1

The 606 is used in the offline dust read statements above to apply the scale factor. 
This will change depending on the source of the emissions but 0.0005 is recommended 
for MERRA-2 0.5x0.625 based on initial comparison with AERONET for 2013.

David A. Ridley (2018)
